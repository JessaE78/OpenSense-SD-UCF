<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">  

    <title>OpenSense</title>
</head>
<body>
    <div class="main-container">
        <!-- Top half container -->
        <div class="data-container">
            <div class="data-list" id="data-container"> 
                <!-- Data will be injected here -->
            </div>

            <div class="data-graph">
                <!-- Graph will go here -->
            </div>
        </div>

        <!-- Bottom half container -->
        <div class="button-container">
            <div class="sensor-buttons">
                <button class="sensor-button" id="sensor1" onclick="injectDataFromFile('sensor1')">Temperature</button>
                <button class="sensor-button" id="sensor2" onclick="injectDataFromFile('sensor2')">Humidity</button>
                <button class="sensor-button" id="sensor3" onclick="injectDataFromFile('sensor3')">Lux</button>
            </div>
            <div class="export-clear-buttons">
                <button class="export-button">Graph</button>
                <button class="clear-button" onclick="clearContent()">Clear</button>
            </div>
        </div>
    </div>

    <script>
        var intervalId;
        var dataArray = [];
    
        // fetching data file
        function injectDataFromFile(sensorId) {
            clearInterval(intervalId);

            var dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = '';

            fetch('data.txt')
                .then(response => response.text())
                .then(data => {
                    dataArray = data.split('\n').reverse();
                    injectData(sensorId);
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        function injectData(sensorId) {
            intervalId = setInterval(function() {
                var dataContainer = document.getElementById('data-container');

                if (dataArray.length > 0) {
                    // insert backwards for top down insertion
                    var line = dataArray.pop();
                    var parts = line.split(', ');
                    var newData = document.createElement('p');

                    switch(sensorId) {
                        case 'sensor1':
                            newData.textContent = "Temperature: " + parts[1];
                            break;
                        case 'sensor2':
                            newData.textContent = "Humidity: " + parts[2];
                            break;
                        case 'sensor3':
                            newData.textContent = "Lux: " + parts[3];
                            break;
                        default:
                            newData.textContent = "Unknown sensor";
                    }

                    dataContainer.insertBefore(newData, dataContainer.firstChild);
                } else {
                    clearInterval(intervalId);
                    dataArray = [];
                }
            }, 1000);
        }
    
        function clearContent() {
            clearInterval(intervalId);
            var dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = '';
            dataArray = [];
        }
    </script>
</body>
</html>
