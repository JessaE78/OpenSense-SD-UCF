<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">  

    <title>OpenSense</title>
</head>
<body>
    <div class="main-container">
        <!-- Top half container -->
        <div class="data-container">
            <div class="data-list" id="data-container"> 
                <!-- Data will be injected here -->
            </div>

            <div class="data-graph">

            </div>
        </div>

        <!-- Bottom half container -->
        <div class="button-container">
            <div class="sensor-buttons">
                <button class="sensor-button" onclick="injectDataFromFile()">Sensor 1</button>
                <button class="sensor-button" onclick="injectDataFromFile()">Sensor 2</button>
                <button class="sensor-button" onclick="injectDataFromFile()">Sensor 3</button>
            </div>
            <div class="export-clear-buttons">
                <button class="export-button">Export</button>
                <button class="clear-button" onclick="clearContent()">Clear</button>
            </div>
        </div>
    </div>

    <script>
        var intervalId;
        var dataArray = [];
    
        // fetching data file
        function injectDataFromFile() {
            clearInterval(intervalId);
            var dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = '';
    
            fetch('data.txt')
            .then(response => response.text())
            .then(data => {
                dataArray = data.split('\n').reverse();
                injectData();
            })
            .catch(error => console.error('Error fetching data:', error));
        }
    
        function injectData() {
            intervalId = setInterval(function() {
                var dataContainer = document.getElementById('data-container');
                if (dataArray.length > 0) {
                    // insert backwards for top down insertion
                    var line = dataArray.pop();
                    var parts = line.split(', ');
                    var newData = document.createElement('p');
                    
                    // take first part of file 
                    newData.textContent = parts[0];
                    dataContainer.insertBefore(newData, dataContainer.firstChild);
                    
                    // if too many on screen remove from bottom
                    if (dataContainer.children.length > 8) {
                        dataContainer.removeChild(dataContainer.lastChild);
                    }
                } 
                // stop inject if no signal or new data
                else {
                    clearInterval(intervalId);
                }
            }, 2000);
        }
    
        function clearContent() {
            clearInterval(intervalId);
            var dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = '';
            dataArray = [];
        }
    </script>
</body>
</html>
